<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link href="/css/index.css" rel="stylesheet" />
<link href="/css/boardList.css" rel="stylesheet" />
<script src="/webjars/jquery/3.7.1/jquery.min.js"></script>
<style>
	.menu-test{
		text-align: center;
	}
	.btn {
		padding: 5px 16px;
		border-radius: 4px;
		cursor: pointer;
		width: 100px;
	}
</style>
</head>
<!--
GET /menu : 전체메뉴 조회

GET /menu/type/KR : 한식만 조회
GET /menu/type/CH : 중식만 조회
GET /menu/type/JP : 일식만 조회

GET /menu/taste/MILD : 순한맛만 조회
GET /menu/taste/HOT : 매운맛만 조회

GET /menu/1 : 1번 메뉴 한건만 조회

POST	/menu : 메뉴한건 등록

PUT		/menu : 메뉴한건 전체 수정
PATCH	/menu : 메뉴한건 일부 수정

DELETE	/menu : 메뉴한건 삭제
-->

<body>
	<div th:replace="/fragments/header.html :: fragment-menu"></div>
	<h1 align="center">MENU RESTFUL API</h1>
	<div class="outer">
		
		<!--	GET /menu : 전체메뉴 조회 -->
		<div class="menu-test">
			<h3>전체 메뉴</h3>
			<button type="button" onclick="menuAllList()" class="btn">조회</button><br><br>
		</div>
		<div id="menu-result">
		<br><br>	
		</div>
		<hr>
		
		<script>
			function menuAllList(){
				$.ajax({
					url: '/menu',
					method: 'GET',
					success(result){
						console.log(result);
						menuTable('#menu-result', result);
					},
					error: console.log
				})
			}
		</script>
		<!--
			2.
			GET /menu/type/KR : 한식만 조회
			GET /menu/type/CH : 중식만 조회
			GET /menu/type/JP : 일식만 조회
		-->
		<div class="menu-test">
			<h3>메뉴 타입별 조회(GET)</h3>
			<select id="typeSelector">
				<option value="" selected></option>
				<option value="KR" >한식</option>
				<option value="CH" >중식</option>
				<option value="JP" >일식</option>
			</select>
		</div>
			<br><br>
		<div id="menuType-result"></div>
		<hr>
		<script type="text/javascript">
			document.querySelector("#typeSelector").addEventListener('change', (e) => {
				console.log(e.target.value);
				$.ajax({
					url: `/menu/type/${e.target.value}`,
					success: function(result){
						console.log(result);
						menuTable("#menuType-result", result);
					},
					error: console.log
				});
			});
		</script>
		<!--
			3. GET /menu/taste/KR/taste/MILD
			GET /menu/taste/MILD : 순한맛만 조회
			GET /menu/taste/HOT : 매운맛만 조회
		-->
		<div class="menu-test">
			<h3>메뉴 타입과 맛별 조회(GET)</h3>
			<form name="menuTypeTasteFrm">
				<div>
					<input type="radio" name="type" value="KR">한식
					<input type="radio" name="type" value="CH">중식
					<input type="radio" name="type" value="JP">일식
				</div>
				<br>
				<div>
					<input type="radio" name="taste" value="MILD">순한맛
					<input type="radio" name="taste" value="HOT">매운맛
				</div>
				<br><br>
				<button class="btn">조 회</button>
			</form>
		</div>
		<br><br>
		<div id="menuTypeTaste-result"></div>
		<hr>
		<script>
			document.menuTypeTasteFrm.addEventListener('submit', (e) => {
				e.preventDefault();		//submit을 막아주는 이벤트
				const type = e.target.type.value;
				const taste = e.target.taste.value;
				$.ajax({
					url: `/menu/type/${type}/taste/${taste}`,
					success: function(result) {
						console.log(result);
						menuTable("#menuTypeTaste-result", result);
					},
					error: console.log
				});
			});
		</script>
		
		
		<!--
			4. POST /menu 
			
		-->
		<div class="menu-test">
			<h3>메뉴 등록하기(POST)</h3>
			<form name="menuEnrollFrm">
				음식점 : <input name="restaurant" required><br>
				메뉴명 : <input name="name" required><br>
				가&emsp;격 : <input type="number" name="price" required><br>
				<div>
					<input type="radio" name="type" value="KR">한식
					<input type="radio" name="type" value="CH">중식
					<input type="radio" name="type" value="JP">일식
				</div>
				<div>
					<input type="radio" name="taste" value="MILD">순한맛
					<input type="radio" name="taste" value="HOT">매운맛
				</div>
				<br>
				<button class="btn">등 록</button>
				</br>
			</form>
		</div><br>
		<hr>
		<script>
			document.menuEnrollFrm.addEventListener('submit', (e) => {
				e.preventDefault();
				const menu = {
					restaurant : e.target.restaurant.value,
					name : e.target.name.value,
					price : e.target.price.value,
					type : e.target.type.value,
					taste : e.target.taste.value
				}
				console.log(menu);
				
				// 직렬화 restaurant=식당명&name=메뉴명&price=4332... 이런게 직렬화다
				$.ajax({
					url: '/menu',
					data: JSON.stringify(menu),
					method: 'POST',
					contentType : 'application/json; charset=utf-8',	// json 타입으로 한글깨지지 않게 보내기
					success (result, textStatus, jqXHR) {
						console.log(result);
						console.log(textStatus);
						console.log(jqXHR.getResponseHeader('Location'));
					},
					error: console.log
				})
			});
		</script>
		
		
		<!-- post  menu 등록-->
		<script>
			const findById = id => {
				console.log(id);
				$.ajax({
					url:`/menu/${id}`,
					success (result){
						console.log(result);
					},
					error(jqXHR, textStatus, errorMsg){ // jquery에서 제공해주는 error처리 3가지
						console.log(`jqXHR : ${jqXHR}`);	//[object]  출력
						console.log(`jqXHR.status : ${jqXHR.status}`);
						console.log(`jqXHR.statusText : ${jqXHR.statusText}`);	//error 고정
						console.log(`textStatus : ${textStatus}`);	//error고정
						console.log(`errorMsg : ${errorMsg}`);		//http 오류 메시지 출력
						
						if(jqXHR.status == 404) {
							alert("조회한 메뉴는 존재하지 않습니다.");
						}
					}
				})
			}
			
			const menuTable = (selector, data) => {
				const container = document.querySelector(selector);
				let value = `<table id="list-area" align="center">
							 	<thead>
									 <tr>
										 <th width="10%">번호</th>
										 <th width="25%">메뉴명</th>
										 <th width="15%">가격</th>
										 <th width="25%">가게명</th>
										 <th width="15%">맛</th>
										 <th width="10%">종류</th>
									 </tr>
								</thead>
								<tbody>`;
									
				 if(data.length > 0){
					 data.forEach(item => {
						value += ` <tr>
									 <td><a href="javascript:findById('${item.id}')">${item.id}</td>
									 <td>${item.name}</td>
									 <td>${item.price}</td>
									 <td>${item.restaurant}</td>
									 <td>${item.taste}</td>
									 <td>${item.type}</td>
								 </tr>`; 
					 });
				 }else{
					 value += `<tr><td colspan="6">조회된 결과가 없습니다</td></tr>`;
				 }
				 
				 value += `</tbody></table>`;
				 container.innerHTML = value;
			}
		</script>
		
	</div>

</body>
</html>






















